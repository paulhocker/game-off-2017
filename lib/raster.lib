/*
    copyright 2017 SpockerDotNet LLC
    released under MIT License.

    raster.asm

    a module for handling and managing
    raster interrupts

*/

#import "./bits.lib"
#import "./vic2.lib" 

.label VECTOR_IRQ = $0314

.macro initRasterInterrupt(position, routine) {

    sei

    //  set the timer interrupt off
    lda #$7f
    sta $dc0d
    sta $dd0d

    //  set the raster interrupt on
    lda #$01
    sta $d01a

    lda #$35
    sta $01

    //  set the next interrupt to our preferred location
    setInterruptVector(position, routine)

    asl $d019
    bit $dc0d
    bit $dd0d

    cli
}

.macro startInterrupt() {

    pha
    txa
    pha
    tya
    pha

}

.macro endInterrupt() {

    asl $d019

    pla
    tay
    pla
    tax
    pla

    rti
}

.macro setInterruptVector(position, routine) {

    lda #position
    sta $d012

    lda #$1b
    sta $d011

    lda #<routine
    //sta VECTOR_IRQ
    sta $fffe
    lda #>routine
    //sta VECTOR_IRQ + 1
    sta $ffff

}